# üöÄ –®–≤–∏–¥–∫–∏–π —á–µ–∫–ª–∏—Å—Ç: Production Payment Flow

## ‚úÖ –©–æ –≤–∂–µ –∑—Ä–æ–±–ª–µ–Ω–æ (–≤ –∫–æ–¥—ñ):

- [x] `/pay?tg_id=123` ‚Äî –ø–µ—Ä–µ–¥–∞—á–∞ Telegram ID –≤ Stripe
- [x] Webhook –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –Ω–∞–¥—Å–∏–ª–∞—î —ñ–Ω–≤–∞–π—Ç-–ª—ñ–Ω–∫
- [x] –ö–æ–º–∞–Ω–¥–∞ `/pay` —Ñ–æ—Ä–º—É—î –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π URL
- [x] –ö–Ω–æ–ø–∫–∞ "–ö—É–ø–∏—Ç–∏ –∫—É—Ä—Å" –æ–Ω–æ–≤–ª–µ–Ω–∞
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è —Å—Ç–≤–æ—Ä–µ–Ω–∞

---

## ‚è≥ –©–æ —Ç—Ä–µ–±–∞ –∑—Ä–æ–±–∏—Ç–∏ –¢–û–ë–Ü (3 —Ö–≤–∏–ª–∏–Ω–∏):

### 1Ô∏è‚É£ –î–æ–¥–∞—Ç–∏ PAID_CHANNEL_LINK –Ω–∞ Render

**–î–µ:** https://dashboard.render.com/ ‚Üí glucklichkurs-bot ‚Üí Environment

**–©–æ –¥–æ–¥–∞—Ç–∏:**
```
Key: PAID_CHANNEL_LINK
Value: https://t.me/+BVlgP_AqpcowYTcy
```

**–Ø–∫:**
1. –í—ñ–¥–∫—Ä–∏–π Render Dashboard
2. glucklichkurs-bot ‚Üí Environment tab
3. "Add Environment Variable"
4. –í–≤–µ–¥–∏ Key + Value
5. Save Changes
6. –ß–µ–∫–∞–π 2-3 —Ö–≤ (auto-redeploy)

---

### 2Ô∏è‚É£ –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ Stripe Webhook URL

**–î–µ:** https://dashboard.stripe.com/webhooks

**–ú–∞—î –±—É—Ç–∏:**
```
URL: https://glucklichkurs-bot.onrender.com/stripe/webhook
Events: checkout.session.completed
```

**–Ø–∫—â–æ –Ω–µ–º–∞—î:**
1. Create webhook endpoint
2. URL: `https://glucklichkurs-bot.onrender.com/stripe/webhook`
3. Events to send: `checkout.session.completed`
4. –ö–æ–ø—ñ—é–π Signing secret ‚Üí Render env `STRIPE_WEBHOOK_SECRET`

---

### 3Ô∏è‚É£ –ü—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏ –ø–æ—Ç—ñ–∫

**–¢–µ—Å—Ç 1: –ö–æ–º–∞–Ω–¥–∞ /pay**
1. –ù–∞–ø–∏—à–∏ –±–æ—Ç—É `/pay`
2. –ú–∞—î –ø–æ–∫–∞–∑–∞—Ç–∏ –ª—ñ–Ω–∫: `https://glucklichkurs-bot.onrender.com/pay?tg_id=—Ç–≤—ñ–π_id`

**–¢–µ—Å—Ç 2: –ö–Ω–æ–ø–∫–∞ "–ö—É–ø–∏—Ç–∏"**
1. –ù–∞—Ç–∏—Å–Ω–∏ –∫–Ω–æ–ø–∫—É –≤ –º–µ–Ω—é
2. –ú–∞—î –ø–æ–∫–∞–∑–∞—Ç–∏ —Ç–æ–π —Å–∞–º–∏–π –ª—ñ–Ω–∫

**–¢–µ—Å—Ç 3: –û–ø–ª–∞—Ç–∞ (—Ç–µ—Å—Ç–æ–≤–∞ –∫–∞—Ä—Ç–∫–∞)**
```
–ö–∞—Ä—Ç–∫–∞: 4242 4242 4242 4242
–¢–µ—Ä–º—ñ–Ω: –±—É–¥—å-—è–∫–∏–π –º–∞–π–±—É—Ç–Ω—ñ–π
CVC: –±—É–¥—å-—è–∫–∏–π 3-–∑–Ω–∞—á–Ω–∏–π
```

**–¢–µ—Å—Ç 4: –û—Ç—Ä–∏–º–∞–Ω–Ω—è –ª—ñ–Ω–∫—É**
- –ß–µ—Ä–µ–∑ 2-5 —Å–µ–∫ –ø—ñ—Å–ª—è –æ–ø–ª–∞—Ç–∏ –º–∞—î –ø—Ä–∏–π—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è:
  ```
  üéâ –û–ø–ª–∞—Ç—É –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ!
  
  –í—ñ—Ç–∞—î–º–æ —É –∑–∞–∫—Ä–∏—Ç–æ–º—É –∫—É—Ä—Å—ñ...
  üîó https://t.me/+BVlgP_AqpcowYTcy
  ```

---

## üìä –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ª–æ–≥—ñ–≤ Render

–ü—ñ—Å–ª—è —Ç–µ—Å—Ç–æ–≤–æ—ó –æ–ø–ª–∞—Ç–∏ –ø–µ—Ä–µ–≤—ñ—Ä:

```
‚úÖ Payment successful for user 123456789, session cs_xxx
‚úÖ Notification sent to user 123456789
```

–Ø–∫—â–æ –±–∞—á–∏—à:
```
‚ö†Ô∏è TELEGRAM_BOT_TOKEN not set, skipping notification
```
‚Üí –ü–µ—Ä–µ–≤—ñ—Ä env vars –Ω–∞ Render

---

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü—ñ—Å–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —á–µ–∫–ª–∏—Å—Ç—É:

‚úÖ –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–∞—Ç–∏—Å–∫–∞—î `/pay`
‚úÖ –ü–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –Ω–∞ Stripe Checkout
‚úÖ –û–ø–ª–∞—á—É—î –∫–∞—Ä—Ç–æ—é
‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ** –æ—Ç—Ä–∏–º—É—î —ñ–Ω–≤–∞–π—Ç-–ª—ñ–Ω–∫ –≤ Telegram
‚úÖ –ü–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –∑–∞ –ª—ñ–Ω–∫–æ–º ‚Üí –¥–æ—Å—Ç—É–ø –¥–æ –∫–∞–Ω–∞–ª—É
‚úÖ Coach Agent –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –Ω–∞ –ø–∏—Ç–∞–Ω–Ω—è

**–ß–∞—Å –≤—ñ–¥ –æ–ø–ª–∞—Ç–∏ –¥–æ –¥–æ—Å—Ç—É–ø—É: 2-5 —Å–µ–∫—É–Ω–¥** ‚ö°

---

## üìù –ù–∞—Å—Ç—É–ø–Ω—ñ –∫—Ä–æ–∫–∏ (–æ–ø—Ü—ñ–π–Ω–æ):

1. **Guard rules –¥–ª—è Sales Agent** ‚Äî –∑–∞–±–æ—Ä–æ–Ω–∞ –Ω–∞ –º–µ–¥–∏—á–Ω—ñ –ø–æ—Ä–∞–¥–∏
2. **Guard rules –¥–ª—è Coach Agent** ‚Äî –∑–∞–±–æ—Ä–æ–Ω–∞ –Ω–∞ –∑–±—ñ—Ä –ø—Ä–∏–≤–∞—Ç–Ω–∏—Ö –¥–∞–Ω–∏—Ö
3. **–ü—É–±–ª—ñ–∫–∞—Ü—ñ—è —É—Ä–æ–∫—ñ–≤ –≤ –∫–∞–Ω–∞–ª** ‚Äî –∞–≤—Ç–æ–ø–æ—Å—Ç–∏–Ω–≥ 10 —É—Ä–æ–∫—ñ–≤
4. **–ù–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è** ‚Äî —á–µ—Ä–µ–∑ 2-3 –¥–Ω—ñ –ø—ñ—Å–ª—è –≤—Å—Ç—É–ø–Ω–æ–≥–æ —É—Ä–æ–∫—É
5. **Analytics** ‚Äî —Å–∫—ñ–ª—å–∫–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –æ–ø–ª–∞—Ç–∏–ª–æ

---

**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤–æ –¥–æ production! üéâ
**–í–µ—Ä—Å—ñ—è:** v3.0.0
**–ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç:** –î–æ–¥–∞—Ç–∏ PAID_CHANNEL_LINK –Ω–∞ Render (–∫—Ä–∏—Ç–∏—á–Ω–æ!)
