# TESTING.md ‚Äî –ö–µ—Ä—ñ–≤–Ω–∏—Ü—Ç–≤–æ –∑ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è

## üß™ –õ–æ–∫–∞–ª—å–Ω–µ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### 1. –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è Telegram –±–æ—Ç–∞

#### –û—Å–Ω–æ–≤–Ω—ñ –∫–æ–º–∞–Ω–¥–∏:
```
/start          ‚Üí –ú–∞—î –ø–æ–∫–∞–∑–∞—Ç–∏ –≥–æ–ª–æ–≤–Ω–µ –º–µ–Ω—é
üéì –í—Å—Ç—É–ø–Ω–∏–π —É—Ä–æ–∫ ‚Üí –ú–∞—î –ø–æ–∫–∞–∑–∞—Ç–∏ —É—Ä–æ–∫ 1 –∑ –±–∞–∑–æ—é –¥–∞–Ω–∏—Ö
üí≥ –ü—Ä–∏–¥–±–∞—Ç–∏ –∫—É—Ä—Å ‚Üí –ú–∞—î –ø–æ–∫–∞–∑–∞—Ç–∏ –ø–æ—Å–∏–ª–∞–Ω–Ω—è /pay
‚ÑπÔ∏è –ü—Ä–æ –∫—É—Ä—Å     ‚Üí –ú–∞—î –≤—ñ–¥–ø–æ–≤—ñ—Å—Ç–∏ —á–µ—Ä–µ–∑ OpenAI
‚öñÔ∏è –Æ—Ä–∏–¥–∏—á–Ω–∞ —ñ–Ω—Ñ ‚Üí –ú–∞—î –ø–æ–∫–∞–∑–∞—Ç–∏ –º–µ–Ω—é —é—Ä–∏–¥–∏—á–Ω–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤
```

#### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö:
```powershell
# –í—ñ–¥–∫—Ä–∏–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–∏—Ö
sqlite3 app.db

# –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
SELECT * FROM users;

# –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —á–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–æ user_id –ø—ñ—Å–ª—è /start
SELECT user_id, username, seen_intro_at FROM users;

# –í–∏–π–¥—ñ—Ç—å
.quit
```

### 2. –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Ç–µ–∫—Å—Ç–æ–≤–∏—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å

–ù–∞–¥—ñ—à–ª—ñ—Ç—å –±—É–¥—å-—è–∫–∏–π —Ç–µ–∫—Å—Ç –±–æ—Ç—É:
- ‚úÖ –ú–∞—î –≤—ñ–¥–ø–æ–≤—ñ—Å—Ç–∏ —á–µ—Ä–µ–∑ OpenAI GPT
- ‚úÖ –ù–µ –º–∞—î –≤–∏–∫–∏–¥–∞—Ç–∏ –ø–æ–º–∏–ª–∫–∏ "null content"

### 3. –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≥–æ–ª–æ—Å–æ–≤–∏—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å

–ù–∞–¥—ñ—à–ª—ñ—Ç—å –≥–æ–ª–æ—Å–æ–≤–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è:
- ‚úÖ –ú–∞—î —Ä–æ–∑–ø—ñ–∑–Ω–∞—Ç–∏ —á–µ—Ä–µ–∑ Whisper (STT)
- ‚úÖ –ú–∞—î –≤—ñ–¥–ø–æ–≤—ñ—Å—Ç–∏ —Ç–µ–∫—Å—Ç–æ–º —á–µ—Ä–µ–∑ GPT
- ‚úÖ –û–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ: –º–∞—î –æ–∑–≤—É—á–∏—Ç–∏ —á–µ—Ä–µ–∑ TTS

### 4. –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è —é—Ä–∏–¥–∏—á–Ω–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤

–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "‚öñÔ∏è –Æ—Ä–∏–¥–∏—á–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è":
- ‚úÖ –ú–∞—î –ø–æ–∫–∞–∑–∞—Ç–∏ –º–µ–Ω—é –∑ 5 –∫–Ω–æ–ø–∫–∞–º–∏
- ‚úÖ –ö–æ–∂–Ω–∞ –∫–Ω–æ–ø–∫–∞ –º–∞—î –ø–æ–∫–∞–∑–∞—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–π –¥–æ–∫—É–º–µ–Ω—Ç –∑ `data/legal/`
- ‚úÖ –ö–Ω–æ–ø–∫–∞ "üîô –ù–∞–∑–∞–¥" –º–∞—î –ø–æ–≤–µ—Ä–Ω—É—Ç–∏ –¥–æ –≥–æ–ª–æ–≤–Ω–æ–≥–æ –º–µ–Ω—é

### 5. –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Å–∏—Å—Ç–µ–º–∏ –Ω–∞–≥–∞–¥—É–≤–∞–Ω—å

```python
# –£ Python –∫–æ–Ω—Å–æ–ª—ñ
from app.storage.db import users_due_for_reminder
import os

# –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –¥–ª—è –Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è
os.environ["REMINDER_DAYS"] = "0"  # –î–ª—è —Ç–µ—Å—Ç—É
users = users_due_for_reminder(0)
print(f"Users to remind: {users}")
```

## üí≥ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è Stripe

### –õ–æ–∫–∞–ª—å–Ω–µ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –∑ Stripe CLI

#### 1. –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å Stripe CLI
```powershell
# Windows (–∑ Scoop)
scoop install stripe

# –ê–±–æ –∑–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ –∑ https://stripe.com/docs/stripe-cli
```

#### 2. –ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—è
```powershell
stripe login
```

#### 3. –ó–∞–ø—É—Å—Ç—ñ—Ç—å webhook forwarding
```powershell
# –£ —Ç–µ—Ä–º—ñ–Ω–∞–ª—ñ 1: –∑–∞–ø—É—Å—Ç—ñ—Ç—å –≤–µ–±-—Å–µ—Ä–≤–µ—Ä
uvicorn app.web.server:app --reload

# –£ —Ç–µ—Ä–º—ñ–Ω–∞–ª—ñ 2: –∑–∞–ø—É—Å—Ç—ñ—Ç—å forwarding
stripe listen --forward-to localhost:8000/stripe/webhook

# –°–∫–æ–ø—ñ—é–π—Ç–µ webhook secret —ñ –¥–æ–¥–∞–π—Ç–µ –¥–æ .env
```

#### 4. –¢–µ—Å—Ç–æ–≤—ñ –ø–ª–∞—Ç–µ–∂—ñ

–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ñ –∫–∞—Ä—Ç–∫–∏ Stripe:
- **–£—Å–ø—ñ—à–Ω–∞ –æ–ø–ª–∞—Ç–∞**: `4242 4242 4242 4242`
- **–í—ñ–¥—Ö–∏–ª–µ–Ω–∞**: `4000 0000 0000 0002`
- CVV: –±—É–¥—å-—è–∫—ñ 3 —Ü–∏—Ñ—Ä–∏
- –î–∞—Ç–∞: –±—É–¥—å-—è–∫–∞ –º–∞–π–±—É—Ç–Ω—è

### –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è —á–µ—Ä–µ–∑ –±–æ—Ç–∞

```
1. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "üí≥ –ü—Ä–∏–¥–±–∞—Ç–∏ –∫—É—Ä—Å"
2. –°–∫–æ–ø—ñ—é–π—Ç–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è (–º–∞—î –º—ñ—Å—Ç–∏—Ç–∏ user_id)
3. –í—ñ–¥–∫—Ä–∏–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä—ñ
4. –ó–∞–ø–æ–≤–Ω—ñ—Ç—å —Ñ–æ—Ä–º—É Stripe —Ç–µ—Å—Ç–æ–≤–æ—é –∫–∞—Ä—Ç–∫–æ—é
5. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ:
   - ‚úÖ –†–µ–¥—ñ—Ä–µ–∫—Ç –Ω–∞ /paid
   - ‚úÖ Webhook –æ—Ç—Ä–∏–º–∞–Ω–æ
   - ‚úÖ is_paid=1 –≤ –±–∞–∑—ñ –¥–∞–Ω–∏—Ö
```

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤ –±–∞–∑—ñ –¥–∞–Ω–∏—Ö
```sql
-- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Å—Ç–∞—Ç—É—Å –æ–ø–ª–∞—Ç–∏
SELECT user_id, username, is_paid, stripe_session_id FROM users WHERE user_id = –í–ê–®_USER_ID;

-- –ú–∞—î –ø–æ–∫–∞–∑–∞—Ç–∏ is_paid = 1
```

## üîç –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ª–æ–≥—ñ–≤

### –õ–æ–≥–∏ –±–æ—Ç–∞
```powershell
# –ü—ñ–¥ —á–∞—Å —Ä–æ–±–æ—Ç–∏ –±–æ—Ç–∞ —à—É–∫–∞–π—Ç–µ:
‚úÖ Reminder scheduler started
‚úÖ Bot is running...
‚úÖ Payment successful for user XXX
```

### –õ–æ–≥–∏ Stripe webhook
```powershell
# –£ Stripe CLI
stripe listen --print-json

# –ê–±–æ –≤ –∫–æ–¥—ñ (–≤—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å DEBUG=true –≤ .env)
```

## üêõ –¢–∏–ø–æ–≤—ñ –ø–æ–º–∏–ª–∫–∏ —Ç–∞ —Ä—ñ—à–µ–Ω–Ω—è

### –ü–æ–º–∏–ª–∫–∞: "ModuleNotFoundError: No module named 'app.storage'"
```powershell
# –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—å —â–æ –∑–∞–ø—É—Å–∫–∞—î—Ç–µ –∑ –∫–æ—Ä–µ–Ω—è –ø—Ä–æ–µ–∫—Ç—É
python -m app.bot.main  # ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
cd app && python bot/main.py  # ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
```

### –ü–æ–º–∏–ª–∫–∞: "BadRequestError: Invalid value for 'content'"
```
–í–∂–µ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–æ: –¥–æ–¥–∞–Ω–æ —Ñ—ñ–ª—å—Ç—Ä F.text –≤ handlers/text.py
```

### –ü–æ–º–∏–ª–∫–∞: "sqlite3.OperationalError: no such table: users"
```powershell
# –ë–∞–∑–∞ —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–∏ –ø–µ—Ä—à–æ–º—É –∑–∞–ø—É—Å–∫—É
# –Ø–∫—â–æ –ø—Ä–æ–±–ª–µ–º–∞ –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è - –≤–∏–¥–∞–ª—ñ—Ç—å app.db —Ç–∞ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç—ñ—Ç—å
rm app.db
python -m app.bot.main
```

### Stripe webhook –Ω–µ —Å–ø—Ä–∞—Ü—å–æ–≤—É—î
```
1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ STRIPE_WEBHOOK_SECRET –≤ .env
2. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —â–æ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω–æ
3. –í–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ Stripe CLI –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è
4. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ URL –≤ Stripe Dashboard (–º–∞—î –±—É—Ç–∏ HTTPS –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)
```

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ—î–º

- [ ] `.env` –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ –∑ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–º–∏ –∫–ª—é—á–∞–º–∏
- [ ] –ë–∞–∑–∞ –¥–∞–Ω–∏—Ö —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ
- [ ] –ë–æ—Ç –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –Ω–∞ `/start`
- [ ] OpenAI API –ø—Ä–∞—Ü—é—î (—Ç–µ–∫—Å—Ç–æ–≤—ñ —Ç–∞ –≥–æ–ª–æ—Å–æ–≤—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è)
- [ ] Stripe —Ç–µ—Å—Ç –ø—Ä–æ–π–¥–µ–Ω–æ —É—Å–ø—ñ—à–Ω–æ
- [ ] Webhook –æ—Ç—Ä–∏–º—É—î –ø–æ–¥—ñ—ó
- [ ] –Æ—Ä–∏–¥–∏—á–Ω—ñ –¥–æ–∫—É–º–µ–Ω—Ç–∏ –ø–æ–∫–∞–∑—É—é—Ç—å—Å—è –∫–æ—Ä–µ–∫—Ç–Ω–æ
- [ ] –°–∏—Å—Ç–µ–º–∞ –Ω–∞–≥–∞–¥—É–≤–∞–Ω—å –∑–∞–ø—É—â–µ–Ω–∞
- [ ] –õ–æ–≥–∏ —á–∏—Å—Ç—ñ –±–µ–∑ –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –ø–æ–º–∏–ª–æ–∫

## üìä –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –ø—ñ—Å–ª—è –∑–∞–ø—É—Å–∫—É

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∫–æ–∂–Ω—ñ 24 –≥–æ–¥–∏–Ω–∏:
```sql
-- –°–∫—ñ–ª—å–∫–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –∑–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞–ª–æ—Å—å
SELECT COUNT(*) FROM users;

-- –°–∫—ñ–ª—å–∫–∏ –æ–ø–ª–∞—Ç–∏–ª–∏
SELECT COUNT(*) FROM users WHERE is_paid=1;

-- –ö–æ–Ω–≤–µ—Ä—Å—ñ—è
SELECT 
  ROUND(100.0 * SUM(CASE WHEN is_paid=1 THEN 1 ELSE 0 END) / COUNT(*), 2) as conversion_rate
FROM users 
WHERE seen_intro_at IS NOT NULL;
```

### –õ–æ–≥–∏ –ø–æ–º–∏–ª–æ–∫
```bash
# –®—É–∫–∞–π—Ç–µ –≤ –ª–æ–≥–∞—Ö
grep -i "error\|exception\|failed" bot.log
```

## üéØ –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø—ñ—Ö—É

- **–ö–æ–Ω–≤–µ—Ä—Å—ñ—è**: >10% –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –ø—ñ—Å–ª—è intro –∫—É–ø—É—é—Ç—å –∫—É—Ä—Å
- **–ß–∞—Å –¥–æ –ø–æ–∫—É–ø–∫–∏**: <3 –¥–Ω—ñ –ø—ñ—Å–ª—è –≤—Å—Ç—É–ø–Ω–æ–≥–æ —É—Ä–æ–∫—É
- **–ü–æ–º–∏–ª–∫–∏**: <1% –≤—ñ–¥ –∑–∞–≥–∞–ª—å–Ω–æ—ó –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –∑–∞–ø–∏—Ç—ñ–≤
- **–ß–∞—Å –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –±–æ—Ç–∞**: <2 —Å–µ–∫—É–Ω–¥–∏

---

**–ü—ñ–¥—Ç—Ä–∏–º–∫–∞**: –Ø–∫—â–æ –≤–∏–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º–∏, —Å—Ç–≤–æ—Ä—ñ—Ç—å Issue –Ω–∞ GitHub.
